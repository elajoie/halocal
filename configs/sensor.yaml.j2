{% for d in doorsensor %}
  - name: "{{ d.name }}"
    state_topic: "stat/{{ d.name }}/BATT"
    icon: mdi:battery
    unique_id: '{{ d.name }}_battery'
    device:
      identifiers:
        - '{{ d.name }}'
      name: "{{ d.name }}_id"
      manufacturer: Tasmota

{% endfor %}
{% for t in temp %}
  - name: "{{ t.name }} Temp"
    state_topic: "tele/{{ t.name }}/SENSOR"
    unit_of_measurement: 'Â°C'
    value_template: "{{ '{{' }} value_json.AM2301.Temperature {{ '}}' }}"

{% endfor %}
{% for h in humidity %}
  - name: "{{ h.name }} Humidity"
    state_topic: "tele/{{ h.name }}/SENSOR"
    unit_of_measurement: '%'
    value_template: "{{ '{{' }} value_json.AM2301.Humidity {{ '}}' }}"

{% endfor %}
{% for w in watts %}
  - name: "{{ w.name }} Watts"
    state_topic: "tele/{{ w.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["ENERGY"]["Power"] {{ '}}' }}'
    unit_of_measurement: "W"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Energy Total"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["1_8_0"] {{ '}}' }}'
    unit_of_measurement: "kWh"
    device_class: energy
    state_class: total_increasing

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Energy Total T1"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["1_8_1"] {{ '}}' }}'
    unit_of_measurement: "kWh"
    device_class: energy
    state_class: total_increasing

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Energy Total T2"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["1_8_2"] {{ '}}' }}'
    unit_of_measurement: "kWh"
    device_class: energy
    state_class: total_increasing

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Energy Export"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["2_8_0"] {{ '}}' }}'
    unit_of_measurement: "kWh"
    device_class: energy
    state_class: total_increasing

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Power Total"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["16_7_0"] {{ '}}' }}'
    unit_of_measurement: "W"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Power L1"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["36_7_0"] {{ '}}' }}'
    unit_of_measurement: "W"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Power L2"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["56_7_0"] {{ '}}' }}'
    unit_of_measurement: "W"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Power L3"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["76_7_0"] {{ '}}' }}'
    unit_of_measurement: "W"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Voltage L1"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["32_7_0"] {{ '}}' }}'
    unit_of_measurement: "V"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Voltage L2"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["52_7_0"] {{ '}}' }}'
    unit_of_measurement: "V"

{% endfor %}
{% for m in meters %}
  - name: "{{ m.name }} Voltage L3"
    state_topic: "tele/{{ m.name }}/SENSOR"
    value_template: '{{ '{{' }} value_json["{{ m.name }}"]["72_7_0"] {{ '}}' }}'
    unit_of_measurement: "V"

{% endfor %}
